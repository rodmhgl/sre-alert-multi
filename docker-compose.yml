services:
  # Ollama-based SRE Alert System (Default)
  sre-ollama:
    build: .
    container_name: sre-alert-ollama
    ports:
      - "5001:5000"
    environment:
      - AI_MODEL_PROVIDER=ollama
      - AI_MODEL_NAME=qwen2:0.5b
      - OLLAMA_BASE_URL=http://ollama-service.ollama.svc.cluster.local:5000
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Claude-based SRE Alert System
  sre-claude:
    build: .
    container_name: sre-alert-claude
    ports:
      - "5002:5000"
    environment:
      - AI_MODEL_PROVIDER=claude
      - AI_MODEL_NAME=claude-3-haiku-20240307
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    profiles:
      - claude

  # OpenAI ChatGPT-based SRE Alert System
  sre-openai:
    build: .
    container_name: sre-alert-openai
    ports:
      - "5003:5000"
    environment:
      - AI_MODEL_PROVIDER=openai
      - AI_MODEL_NAME=gpt-3.5-turbo
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    profiles:
      - openai

  # Google Gemini-based SRE Alert System
  sre-gemini:
    build: .
    container_name: sre-alert-gemini
    ports:
      - "5004:5000"
    environment:
      - AI_MODEL_PROVIDER=gemini
      - AI_MODEL_NAME=gemini-1.5-flash
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    profiles:
      - gemini

  # Multi-provider fallback system
  sre-multi:
    build: .
    container_name: sre-alert-multi
    ports:
      - "5000:5000"
    environment:
      - AI_MODEL_PROVIDER=claude
      - AI_MODEL_NAME=claude-3-haiku-20240307
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OLLAMA_BASE_URL=http://ollama-service.ollama.svc.cluster.local:5000
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    profiles:
      - multi

networks:
  default:
    name: sre-alert-network
